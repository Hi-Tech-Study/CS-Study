<!DOCTYPE html> <html lang="en"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <link rel="stylesheet" href="/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet"> <style id="jtd-nav-activation"> .site-nav > ul.nav-list:first-child > li:not(:nth-child(69)) > a, .site-nav > ul.nav-list:first-child > li > ul > li a { background-image: none; } .site-nav > ul.nav-list:not(:first-child) a, .site-nav li.external a { background-image: none; } .site-nav > ul.nav-list:first-child > li:nth-child(69) > a { font-weight: 600; text-decoration: none; }.site-nav > ul.nav-list:first-child > li:nth-child(69) > button svg { transform: rotate(-90deg); }.site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(69) > ul.nav-list { display: block; } </style> <script src="/assets/js/vendor/lunr.min.js"></script> <script src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>이벤트 소싱(Event Sourcing)과 CQRS(Command Query Responsibillity Segregation) | Dev Open Library</title> <meta name="generator" content="Jekyll v3.10.0" /> <meta property="og:title" content="이벤트 소싱(Event Sourcing)과 CQRS(Command Query Responsibillity Segregation)" /> <meta property="og:locale" content="en" /> <meta name="description" content="A minimal, responsive and feature-rich Jekyll theme for technical writing." /> <meta property="og:description" content="A minimal, responsive and feature-rich Jekyll theme for technical writing." /> <link rel="canonical" href="http://localhost:4000/Database/db_event_sourcing_cqrs.html" /> <meta property="og:url" content="http://localhost:4000/Database/db_event_sourcing_cqrs.html" /> <meta property="og:site_name" content="Dev Open Library" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="이벤트 소싱(Event Sourcing)과 CQRS(Command Query Responsibillity Segregation)" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"A minimal, responsive and feature-rich Jekyll theme for technical writing.","headline":"이벤트 소싱(Event Sourcing)과 CQRS(Command Query Responsibillity Segregation)","url":"http://localhost:4000/Database/db_event_sourcing_cqrs.html"}</script> <!-- End Jekyll SEO tag --> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header" role="banner"> <a href="/" class="site-title lh-tight"> Dev Open Library </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </button> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/" class="nav-list-link">CS Study Notes</a></li><li class="nav-list-item"><a href="/Web/web_cdn.html" class="nav-list-link">CDN (Content Delivery Network)</a></li><li class="nav-list-item"><a href="/Network/network_cors.html" class="nav-list-link">CORS</a></li><li class="nav-list-item"><a href="/OS/os_cpu_scheduling.html" class="nav-list-link">CPU Scheduling</a></li><li class="nav-list-item"><a href="/Web/web_csr_ssr.html" class="nav-list-link">CSR, SSR 의 등장 배경</a></li><li class="nav-list-item"><a href="/Web/web_csrf.html" class="nav-list-link">CSRF(Cross-site request forgery, 사이트 간 요청 위조)</a></li><li class="nav-list-item"><a href="/OS/os_com_and_operating_system.html" class="nav-list-link">Computer 구조</a></li><li class="nav-list-item"><a href="/Database/db_cache.html" class="nav-list-link">DB 캐싱</a></li><li class="nav-list-item"><a href="/Algorithm/ag_dfs_bfs.html" class="nav-list-link">DFS와 BFS</a></li><li class="nav-list-item"><a href="/Algorithm/ag_dp.html" class="nav-list-link">DP (Dynamic Programming)</a></li><li class="nav-list-item"><a href="/OS/os_deadlock.html" class="nav-list-link">Deadlock이란?</a></li><li class="nav-list-item"><a href="/Network/network_dns.html" class="nav-list-link">Domain</a></li><li class="nav-list-item"><a href="/Design_Pattern/dp_factory_pattern.html" class="nav-list-link">Factory Pattern</a></li><li class="nav-list-item"><a href="/Algorithm/ag_gcd_lcm.html" class="nav-list-link">GCD(Greatest Common Divisor) 알고리즘</a></li><li class="nav-list-item"><a href="/Web/graphql.html" class="nav-list-link">GraphQL</a></li><li class="nav-list-item"><a href="/Network/network_http_https.html" class="nav-list-link">HTTP (Hyper Text Transfer Protocol)</a></li><li class="nav-list-item"><a href="/Network/network_http_message.html" class="nav-list-link">HTTP 메시지</a></li><li class="nav-list-item"><a href="/Network/network_ip.html" class="nav-list-link">IP의 정의와 역할</a></li><li class="nav-list-item"><a href="/Database/db_index.html" class="nav-list-link">Index? 그게뭔데!</a></li><li class="nav-list-item"><a href="/Design_Pattern/dp_iterator_pattern.html" class="nav-list-link">Iterator pattern</a></li><li class="nav-list-item"><a href="/Web/web_jwt.html" class="nav-list-link">JWT</a></li><li class="nav-list-item"><a href="/Design_Pattern/dp_mvc_pattern.html" class="nav-list-link">MVC 패턴</a></li><li class="nav-list-item"><a href="/Design_Pattern/dp_mvp_pattern.html" class="nav-list-link">MVP Architecture Pattern</a></li><li class="nav-list-item"><a href="/Design_Pattern/dp_mvvm_pattern.html" class="nav-list-link">MVVM 패턴 정의</a></li><li class="nav-list-item"><a href="/Data_Structure/ds_map.html" class="nav-list-link">Map</a></li><li class="nav-list-item"><a href="/OS/os_memory.html" class="nav-list-link">Memory</a></li><li class="nav-list-item"><a href="/OS/os_multi_processing.html" class="nav-list-link">Multi Process (멀티 프로세스)</a></li><li class="nav-list-item"><a href="/Network/network_devices.html" class="nav-list-link">Network Device</a></li><li class="nav-list-item"><a href="/Network/network_osi_tcpip.html" class="nav-list-link">OSI 7계층 &amp; TCP/IP 4계층</a></li><li class="nav-list-item"><a href="/OS/os_pcb_and_context_switch.html" class="nav-list-link">PCB와 Context Switching</a></li><li class="nav-list-item"><a href="/Database/db_query_optimization.html" class="nav-list-link">Query Optimization(Slow Query Tuning)</a></li><li class="nav-list-item"><a href="/Algorithm/ag_quick_sort.html" class="nav-list-link">Quick Sort</a></li><li class="nav-list-item"><a href="/Web/restful_api.html" class="nav-list-link">RESTful API 설계 원칙과 네이밍 컨벤션</a></li><li class="nav-list-item"><a href="/Data_Structure/ds_set.html" class="nav-list-link">Set</a></li><li class="nav-list-item"><a href="/OS/os_Blocking_Non-Blocking_Synchronous_Asynchronous.html" class="nav-list-link">Synchronous?</a></li><li class="nav-list-item"><a href="/Network/network_tcp.html" class="nav-list-link">TCP</a></li><li class="nav-list-item"><a href="/OS/os_thread.html" class="nav-list-link">Thread</a></li><li class="nav-list-item"><a href="/Network/network_udp.html" class="nav-list-link">UDP (User Datagram Protocol)</a></li><li class="nav-list-item"><a href="/Web/web_ws_was.html" class="nav-list-link">Web Server</a></li><li class="nav-list-item"><a href="/OS/os_mutex_semaphore.html" class="nav-list-link">공유 자원 &amp; 임계 영역(Semaphore &amp; Mutex)</a></li><li class="nav-list-item"><a href="/Algorithm/ag_implementation.html" class="nav-list-link">구현(Implementation)</a></li><li class="nav-list-item"><a href="/Algorithm/ag_greedy.html" class="nav-list-link">그리디 (Greedy)</a></li><li class="nav-list-item"><a href="/Network/readme_NW.html" class="nav-list-link">네트워크</a></li><li class="nav-list-item"><a href="/Network/network_basic.html" class="nav-list-link">네트워크의 기초</a></li><li class="nav-list-item"><a href="/Design_Pattern/dp_revealing_module_pattern.html" class="nav-list-link">노출모듈 패턴 정의</a></li><li class="nav-list-item"><a href="/Algorithm/ag_dijkstra.html" class="nav-list-link">다익스트라(dijkstra) 알고리즘</a></li><li class="nav-list-item"><a href="/Database/db_migration.html" class="nav-list-link">데이터 마이그레이션 정리 노트</a></li><li class="nav-list-item"><a href="/Database/readme_DB.html" class="nav-list-link">데이터베이스</a></li><li class="nav-list-item"><a href="/Database/db_basic.html" class="nav-list-link">데이터베이스(Database) 기초</a></li><li class="nav-list-item"><a href="/Database/db_types_of_databases.html" class="nav-list-link">데이터베이스의 종류</a></li><li class="nav-list-item"><a href="/Design_Pattern/readme_DP.html" class="nav-list-link">디자인패턴</a></li><li class="nav-list-item"><a href="/Network/network_load_balancing.html" class="nav-list-link">로드 밸런싱이란?</a></li><li class="nav-list-item"><a href="/Data_Structure/ds_array_vector.html" class="nav-list-link">배열(Array)</a></li><li class="nav-list-item"><a href="/Database/db_backup_recovery.html" class="nav-list-link">백업(Backup)과 복구(Recovery)</a></li><li class="nav-list-item"><a href="/Database/db_distributed_database.html" class="nav-list-link">분산형 데이터베이스</a></li><li class="nav-list-item"><a href="/Algorithm/ag_divide_and_conquer.html" class="nav-list-link">분할 정복 알고리즘</a></li><li class="nav-list-item"><a href="/Algorithm/ag_bitMask.html" class="nav-list-link">비트마스크</a></li><li class="nav-list-item"><a href="/Algorithm/ag_permutation_combination.html" class="nav-list-link">순열 &amp; 조합</a></li><li class="nav-list-item"><a href="/Algorithm/ag_stack_queue.html" class="nav-list-link">스택 &amp; 큐</a></li><li class="nav-list-item"><a href="/Data_Structure/ds_stack_queue.html" class="nav-list-link">스택 &amp; 큐</a></li><li class="nav-list-item"><a href="/Database/db_explain.html" class="nav-list-link">실행 계획(EXPLAIN) 분석</a></li><li class="nav-list-item"><a href="/Design_Pattern/dp_singleton_pattern.html" class="nav-list-link">싱글톤 패턴</a></li><li class="nav-list-item"><a href="/Algorithm/readme_AG.html" class="nav-list-link">알고리즘</a></li><li class="nav-list-item"><a href="/Data_Structure/ds_Time_Space%20Complexity.html" class="nav-list-link">알고리즘의 성능 분석: Big-O 표기법과 복잡도 이해하기</a></li><li class="nav-list-item"><a href="/Data_Structure/ds_linked_list.html" class="nav-list-link">연결 리스트 (Linked List)</a></li><li class="nav-list-item"><a href="/OS/readme_OS.html" class="nav-list-link">운영체제</a></li><li class="nav-list-item"><a href="/Web/readme_Web.html" class="nav-list-link">웹</a></li><li class="nav-list-item"><a href="/Network/network_web_server.html" class="nav-list-link">웹 서버</a></li><li class="nav-list-item"><a href="/Database/db_event_sourcing_cqrs.html" class="nav-list-link">이벤트 소싱(Event Sourcing)과 CQRS(Command Query Responsibillity Segregation)</a></li><li class="nav-list-item"><a href="/Algorithm/ag_binary_search.html" class="nav-list-link">이분 탐색 (Binary Search)</a></li><li class="nav-list-item"><a href="/Data_Structure/ds_binary_tree.html" class="nav-list-link">이진 트리, 이진 탐색 트리</a></li><li class="nav-list-item"><a href="/Data_Structure/readme_DS.html" class="nav-list-link">자료구조</a></li><li class="nav-list-item"><a href="/Design_Pattern/dp_strategy_pattern.html" class="nav-list-link">전략패턴(Strategy Pattern) 개요</a></li><li class="nav-list-item"><a href="/Database/db_normal_forms.html" class="nav-list-link">정규화</a></li><li class="nav-list-item"><a href="/Design_Pattern/dp_observer_pattern.html" class="nav-list-link">정의</a></li><li class="nav-list-item"><a href="/Database/db_join.html" class="nav-list-link">조인(JOIN)</a></li><li class="nav-list-item"><a href="/Network/cookie_and_session.html" class="nav-list-link">쿠키 &amp; 세션</a></li><li class="nav-list-item"><a href="/Database/db_transaction.html" class="nav-list-link">트랜잭션(Transaction)</a></li><li class="nav-list-item"><a href="/Data_Structure/ds_tree_graph.html" class="nav-list-link">트리와 그래프의 공통점</a></li><li class="nav-list-item"><a href="/Database/db_partitioning_sharding.html" class="nav-list-link">파티셔닝 (Partitioning)</a></li><li class="nav-list-item"><a href="/OS/os_process.html" class="nav-list-link">프로세스(Process)란?</a></li><li class="nav-list-item"><a href="/Design_Pattern/dp_proxy_pattern.html" class="nav-list-link">프록시 패턴 (Proxy Pattern)</a></li><li class="nav-list-item"><a href="/Algorithm/ag_merge_sort.html" class="nav-list-link">합병 정렬(Merge Sort)</a></li><li class="nav-list-item"><a href="/Algorithm/ag_hashing.html" class="nav-list-link">해싱(Hashing)이란?</a></li><li class="nav-list-item"><a href="/Data_Structure/ds_hash_table.html" class="nav-list-link">해싱, 해시 함수 란?</a></li><li class="nav-list-item"><a href="/Data_Structure/ds_heap_priority_queue.html" class="nav-list-link">힙(Heap)</a></li><li class="nav-list-item"><a href="/Algorithm/ag_heap.html" class="nav-list-link">힙(Heap)</a></li><li class="nav-list-item"><a href="/Algorithm/ag_heap_sort.html" class="nav-list-link">힙(Heap)이란, 어떤 자료구조일까?</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Dev Open Library" aria-label="Search Dev Open Library" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div class="main-content-wrap"> <div id="main-content" class="main-content"> <main> <h1 id="이벤트-소싱event-sourcing과-cqrscommand-query-responsibillity-segregation"> <a href="#이벤트-소싱event-sourcing과-cqrscommand-query-responsibillity-segregation" class="anchor-heading" aria-labelledby="이벤트-소싱event-sourcing과-cqrscommand-query-responsibillity-segregation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 이벤트 소싱(Event Sourcing)과 CQRS(Command Query Responsibillity Segregation) </h1> <h2 id="이벤트-소싱event-sourcing"> <a href="#이벤트-소싱event-sourcing" class="anchor-heading" aria-labelledby="이벤트-소싱event-sourcing"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 이벤트 소싱(Event Sourcing) </h2> <p>이벤트 소싱은 도메인에서 발생하는 변경 사항을 추가 전용 로그에 이벤트로 변경 불가능하게 저장하는 아키텍처 설계 패턴입니다.</p> <p>이벤트에는 변화의 맥락(무엇, 언제, 왜, 누가)이 포함되어있고, 각 변경 사항이 발생한 순서대로 있어서 도메인의 현재 상태 이상을 볼 수 있습니다.</p> <p><img src="/Database/img/db_event_sourcing_cqrs_1.png" alt="alt text" /></p> <p><em>이벤트 소싱으로 알 수 있는 상태, 출처<a href="https://www.kurrent.io/event-sourcing">Kurrent - What is Event Sourcing?</a></em></p> <h3 id="예시"> <a href="#예시" class="anchor-heading" aria-labelledby="예시"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 예시 </h3> <p>주문 프로세스로 알아보는 이벤트 소싱</p> <ul> <li> <p>기존 방식</p> <p><img src="/Database/img/db_event_sourcing_cqrs_5.png" alt="alt text" /></p> <ol> <li>ORDER 생성: 고객이 200달러의 상품 주문해 청구서 발행</li> <li>ORDER 업데이트: 청구서를 받은 고객이 비용을 지불함</li> </ol> <p>ORDER의 상태가 변함</p> </li> <li> <p>이벤트 소싱</p> <p><img src="/Database/img/db_event_sourcing_cqrs_6.png" alt="alt text" /></p> <ol> <li>ORDER 추가: 고객이 200달러의 상품을 주문해 청구서 발행</li> <li>ORDER PAYMENT RECEIVED 추가: 고객이 비용을 지불</li> <li>업데이트 된 ORDER 추가: 지불된 내용을 적용</li> </ol> <p>ORDER PAYMENT RECEIVED라는 이벤트가 캡처되어 순서대로 저장</p> </li> <li> <p>만약 50달러가 할인 행사가 있다면?</p> <p><img src="/Database/img/db_event_sourcing_cqrs_7.png" alt="alt text" /></p> <ul> <li>기존 방식: ORDER에서는 200달러의 상품을 150달러에 구매했다는 사실은 알지만, 왜 그렇게 되었는지는 알 수 없습니다.</li> <li>이벤트 소싱: 50달러 할인의 내용이 DISCOUNT APPLIED 의 이벤트로 캡처되어 저장되기 떄문에, 이유에 대해서도 알 수 있습니다.</li> </ul> </li> </ul> <p>특징</p> <ul> <li>데이터 복구 및 디버깅에 유용합니다.</li> <li>구현 복잡도고 높고, 이벤트가 많아질수록 성능 관리가 필요합니다.</li> <li>데이터 동기화 및 이벤트 스키마 변경 관리가 필요합니다.</li> </ul> <h3 id="핵심-내용"> <a href="#핵심-내용" class="anchor-heading" aria-labelledby="핵심-내용"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 핵심 내용 </h3> <ul> <li> <p>이벤트(Event)</p> <p><img src="/Database/img/db_event_sourcing_cqrs_8.png" alt="alt text" /></p> <ul> <li>도메인에서 발생한 사실을 의미하며, 과거 시제로 언급됩니다.</li> <li>단순히 “발생됐다” 보다는 “확실히 변경되었음”의 의미입니다.</li> <li>일반적으로 이벤트 타임스탬프, 주체의 고유 식별자 등과 같은 고유한 메타데이터를 포함합니다.</li> <li>불변(immutable)데이터입니다.</li> </ul> </li> <li> <p>이벤트 스토어(Event Store)</p> <p><img src="/Database/img/db_event_sourcing_cqrs_9.png" alt="alt text" /></p> <ul> <li>각 이벤트는 DB에 기록되며, 기존 DB는 “현재 상태”를 저장하고, 이벤트 스토어는 “상태 변경 기록”을 저장합니다.</li> <li>기존 DB에서 데이터는 수정할 수 있지만, 모든 상태 변경은 새로운 이벤트로 추가되며 기존 이벤트를 유지합니다. <ul> <li>예시: 잘못된 주소로 청구서 발행 이벤트 발생 -&gt; 기존 청구서 무효 이벤트 발생 -&gt; 제대로 된 주소로 청구서 발행 이벤트 발생 =&gt; 수정하는 것이 아니라 3개의 이벤트를 저장</li> </ul> </li> <li>시간순으로 저장되며, 현재 상태는 저장된 이벤트를 재생(replay)하여 계산됩니다. <ul> <li>예시: 현재 계좌 잔액이라는 현재 상태는 입금과 출금 이벤트를 순차적으로 처리해 계산됩니다.</li> </ul> </li> </ul> </li> <li> <p>스트림(Stream)</p> <p><img src="/Database/img/db_event_sourcing_cqrs_10.png" alt="alt text" /></p> <ul> <li>특정 객체와 관련된 모든 이벤트를 시간 순서대로 저장한 묶음입니다.</li> <li>특정 객체는 고유 식별자(보통은 auto increment)를 가지며, 상태를 검색하는 동안 이벤트 순서를 정의하는데 사용하거나 동시성 문제를 감지하는데 사용됩니다.</li> <li>특정 객체 내의 이벤트는 스트림 내에서 고유한 위치를 갖습니다.</li> </ul> </li> <li> <p>프로젝션(Projections)</p> <p><img src="/Database/img/db_event_sourcing_cqrs_2.png" alt="alt text" /></p> <ul> <li>이벤트 스트림을 기반으로 특정 상태를 계산하거나, 읽기 모델(Read Model)을 생성하는 과정입니다.</li> <li>이벤트 데이터를 사용하여 현재 상태를 보여주는 “뷰(View)”를 만드는 것입니다.</li> <li> <p>읽기 모델(Read Model)에서 프로젝션</p> <p><img src="/Database/img/db_event_sourcing_cqrs_3.png" alt="alt text" /></p> <ul> <li>쓰기 모델에서 생성된 이벤트를 가져와 읽기 모델 뷰를 계산한 것을 의미하며,이 내용은 다른 DB에 저장되어 사용될 수 있습니다.</li> <li>변환(Transformation): 기존 이벤트 데이터를 기반으로 새로운 이벤트를 생성하거나 다른 스트림(Stream)에 추가하는 과정을 의미합니다. <ol> <li>주문 스트림(상품 추가 -&gt; 제거 -&gt; 추가 …)</li> <li>변환 과정: 주문의 모든 이벤트를 처리 후 요약(e.g. 가격 합산)을 생성</li> <li>새로운 결제 이벤트 생성: 2번 과정의 결과를 기반으로 새로운 이벤트 생성</li> <li>결제 스트림(결제 수단 선택 -&gt; 결제 요청 -&gt; 완료 …)</li> </ol> </li> </ul> </li> <li>쓰기 모델(Write Model)에서 프로젝션: 스트림 집계(Stream Aggregation) <ul> <li>이벤트를 순서대로 처리하여 도메인 객체의 현재 상태를 계산하는 과정으로, 주요 목적은 명령(Command)이 실행되기 전에 현재 상태를 다시 계산하여 검증하는 것입니다. <ul> <li>예를 들어, 상품을 배송하려면 재고가 충분한지 확인해야 하므로, 모든 재고 관련 이벤트를 처리해 현재 재고 상태를 계산합니다.</li> </ul> </li> <li>프로젝션은 임시적인 데이터로, 언제든 삭제하거나 다시 생성할 수 있습니다.</li> <li>프로젝션은 특정 목적에 맞게 해석된 임시적인 뷰로, 현재 상태가 아닙니다.</li> </ul> </li> </ul> </li> </ul> <h3 id="주의점"> <a href="#주의점" class="anchor-heading" aria-labelledby="주의점"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 주의점 </h3> <ul> <li>지연 <ul> <li>시스템은 다양한 시나리오에서 최종 일관성을 고려해 설계해야합니다.</li> <li>event 게시 과정(application -&gt; event store)과 event에 따라 처리되는 과정을 진행하는 중 추가 변경을 위한 이벤트가 게시되는 상황</li> </ul> </li> <li>동시성 <ul> <li>다중 스레드 혹은 여러 애플리케이션이 동시에 이벤트를 저장하려고 할 수 있는데, 이때 순서가 바뀔 수 있고 이를 주의해야합니다.</li> <li>대부분은 모든 이벤트에 timestamp를 추가하는 것으로 방지할 수 있습니다.</li> </ul> </li> <li>조회 <ul> <li>조회시에는 재생(replay)해야지만 확인할 수 있습니다.</li> </ul> </li> <li>스트림의 길이 <ul> <li>스트림이 큰 경우, 특정 간격으로 스냅샷을 만드는 것이 좋습니다.</li> <li>모든 이벤트를 재생(replay)하지 않고, 가장 가까운 스냅샷부터 이벤트를 재생하면 현재 상태를 확인할 수 있습니다.</li> </ul> </li> <li>불일치 <ul> <li>충돌이 아니더라도, 일관성과 트랜잭션 부족에서 발생하는 불일치를 해결해야합니다.</li> <li>예를 들어, 고객이 해당 품목을 주문하는 동안 재고 감소를 알리는 이벤트가 데이터 저장소에 도착할 수 있습니다.</li> </ul> </li> </ul> <h2 id="cqrscommand-query-responsibillity-segregation"> <a href="#cqrscommand-query-responsibillity-segregation" class="anchor-heading" aria-labelledby="cqrscommand-query-responsibillity-segregation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> CQRS(Command Query Responsibillity Segregation) </h2> <p>애플리케이션에 따라 쓰기 작업의 비율 차이가 높다거나, 쓰기에 대한 데이터와 읽기에 대한 데이터가 다른 등의 이유로 CRUD 아키텍처가 성능을 저하시킬 수 있습니다.</p> <p>CQRS는 명령(Command)과 조회(Query)의 책임(Responsibillity)을 분리(Segregation)하여 각각의 작업에 최적화된 모델을 사용하는 아키텍처 패턴입니다.</p> <ul> <li>명령(Command) <ul> <li>시스템 상태를 변경하는 작업으로, 성공한다면 시스템의 상태가 변경됩니다.</li> <li>예시: 데이터의 변경(create, update, delete 요청), 비즈니스 로직과 트랜잭션 관리</li> </ul> </li> <li>조회(Query) <ul> <li>데이터를 조회하는 작업으로, 비즈니스 로직 없이 데이터를 가져오는 것에 초점되어있으며, 시스템 상태를 변경하지 않고 실행시마다 동일한 결과를 반환합니다.</li> <li>데이터의 조회(query 부분)</li> </ul> </li> </ul> <p><img src="/Database/img/db_event_sourcing_cqrs_4.png" alt="CQRS의 흐름" /></p> <p><em>CQRS의 흐름, 출처: <a href="https://docs.aws.amazon.com/ko_kr/prescriptive-guidance/latest/modernization-data-persistence/cqrs-pattern.html">AWS Prescriptive Guidance - CQRS 패턴</a></em></p> <ol> <li>비즈니스에서는 애플리케이션의 write API를 통해 명령(데이터 추가, 삭제 등)을 전달합니다.</li> <li>애플리케이션은 들어온 명령에 따라, 작업(검증, 승인, 실행 등)을 진행합니다.</li> <li>애플리케이션은 write DB에 데이터의 쓰기 명령을 저장합니다.</li> <li>데이터 쓰기가 write DB에 저장된 후, 이벤트가 트리거 되어 read DB가 업데이트 됩니다.</li> <li>read DB에서도 데이터 쓰기가 저장됩니다.</li> <li>비즈니스에서는 애플리케이션의 read API를 통해 조회를 진행합니다.</li> <li>애플리케이션은 조회 쿼리를 read DB에서 실행합니다.</li> </ol> <h3 id="구성-방법"> <a href="#구성-방법" class="anchor-heading" aria-labelledby="구성-방법"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 구성 방법 </h3> <h4 id="단일-데이터-저장소"> <a href="#단일-데이터-저장소" class="anchor-heading" aria-labelledby="단일-데이터-저장소"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 단일 데이터 저장소 </h4> <p><img src="/Database/img/db_event_sourcing_cqrs_11.png" alt="alt text" /></p> <ul> <li>쓰기 모델 <ul> <li>데이터를 업데이트하거나 유지하는 명령을 처리하도록 설계</li> <li>검증 및 도메인 로직, 트랜잭션 무결성, 비즈니스 프로세스 최적화가 포함됩니다.</li> </ul> </li> <li>읽기 모델 <ul> <li>데이터 검색을 위한 쿼리를 제공하도록 설계</li> <li>프레젠테이션 계층에 최적화된 DTO, 프로젝션(view)을 생성하는데 중점을 둡니다.</li> <li>도메인 로직을 피함으로써 쿼리 성능과 응답성을 향상 시킵니다.</li> </ul> </li> </ul> <h3 id="분리된-데이터-저장소"> <a href="#분리된-데이터-저장소" class="anchor-heading" aria-labelledby="분리된-데이터-저장소"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 분리된 데이터 저장소 </h3> <p>별도의 데이터 저장소를 사용하는 경우 둘 다 동기화 상태를 유지해야 합니다.</p> <p>일반적으로 쓰기 모델이 데이터베이스를 업데이트할 때 이벤트를 게시하고 읽기 모델이 이를 사용하여 데이터를 새로 고치는 방식입니다.</p> <p><img src="/Database/img/db_event_sourcing_cqrs_12.png" alt="alt text" /></p> <ul> <li>읽기 데이터 저장소 <ul> <li>쿼리에 최적화된 자체 데이터 스키마를 사용할 수 있습니다.</li> <li>쓰기 저장소의 읽기 전용 복제본이거나 다른 구조를 가질 수 있습니다.</li> </ul> </li> </ul> <h3 id="특징"> <a href="#특징" class="anchor-heading" aria-labelledby="특징"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 특징 </h3> <ul> <li>각각 최적화: 쓰기와 읽기 작업의 성격이 다르기 때문에, 각각에 최적화된 데이터 모델이나 기술을 사용하는 것이 좋습니다. <ul> <li>명령에는 nosql, 읽기에는 RDB와 같이 DB 조합해 구현할 수 있다.</li> <li>읽기 데이터 저장소: 실체화된 뷰를 저장하면 애플리케이션은 쿼리할 때 복잡한 조인을 피할 수 있습니다.</li> </ul> </li> <li>관심사 분리: 쓰기 측은 일반적으로 복잡한 비즈니스 로직을 처리, 읽기 측은 단순하게 유지하고 쿼리 효율성에 집중</li> <li>메시징 과제: 동기화 유지시 메시징 처리에 대한 문제를 고려해야합니다.</li> <li>일관성 문제: 저장소가 분리된 방식에서는 일관성 문제가 발생할 수 있습니다.</li> </ul> <h2 id="이벤트-소싱과-cqrs의-관계"> <a href="#이벤트-소싱과-cqrs의-관계" class="anchor-heading" aria-labelledby="이벤트-소싱과-cqrs의-관계"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 이벤트 소싱과 CQRS의 관계 </h2> <blockquote> <dl> <dt>“You need to look at CQRS not as being the main thing. CQRS was a product of its time and meant to be a stepping stone towards the ideas of Event Sourcing.”</dt> <dd> <p>(번역 내용을 간단히 요약하자면)CQRS가 중요한게 아니다. CQRS는 이벤트 소싱을 향한 디딤돌이였다.</p> </dd> </dl> <p>“A Decade of DDD, CQRS, Event Sourcing”에서 Greg Young</p> </blockquote> <p>이벤트 소싱은 시스템 상태를 이벤트로 저장하며, CQRS와 결합하면 강력한 확장성과 유연성을 제공합니다.</p> <p><img src="/Database/img/db_event_sourcing_cqrs_13.png" alt="alt text" /></p> <ul> <li>쓰기 측(Write Side): 상태 변경이 일어나는 곳으로, 상태변경을 이벤트 생성하고 저장합니다. <ul> <li>e.g. check out</li> </ul> </li> <li>읽기 측(Read Side): 조회하는 작업을 하는 곳으로, 저장된 이벤트를 기반으로 데이터를 조회하기 위한 읽기 모델을 생성합니다. <ul> <li>e.g. Get order overview</li> </ul> </li> </ul> <p><img src="/Database/img/db_event_sourcing_cqrs_14.png" alt="alt text" /></p> <ul> <li>사용자가 명령(Command)을 실행하면 쓰기 측에서 이벤트가 생성됩니다.</li> <li>생성된 이벤트는 이벤트 저장소에 기록되며, 프로젝션이 이를 구독하여 읽기 모델을 업데이트합니다.</li> <li>읽기 모델은 사용자 인터페이스(UI)나 보고서에서 데이터를 빠르게 조회할 수 있도록 최적화된 형태로 제공됩니다.</li> </ul> <p><img src="/Database/img/db_event_sourcing_cqrs_15.png" alt="alt text" /></p> <ul> <li>프로젝션은 원래 단일 스트림만 구독해 특정 데이터를 터리했지만, 실제 비스니스 요구상황에서는 여러 개의 스트림을 읽어 읽기 모델을 생성해야하는 경우가 많습니다.</li> </ul> <p><img src="/Database/img/db_event_sourcing_cqrs_16.png" alt="alt text" /></p> <ul> <li>더 확장한다면, 이처럼 모든 이벤트 스트림을 읽어야하는 경우도 발생합니다. (e.g. dashboard)</li> <li>이런 상황에서는 집계 아이디(Aggregate ID)가 매우 중요합니다. <ul> <li>각 이벤트는 특정 도메인 객체(e.g. 고객, 주문 etc)와 연관되어있습니다.</li> <li>이 연관성을 나타내는 것이 집계 아이디(Aggregate ID) 또는 식별자 입니다.</li> <li>프로젝션은 여러 이벤트 스트림에서 데이터를 가져올 때, 이 식별자를 기준으로 데이터를 연결하고 통합합니다.</li> </ul> </li> </ul> <h2 id="출처"> <a href="#출처" class="anchor-heading" aria-labelledby="출처"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 출처 </h2> <ul> <li><a href="https://www.kurrent.io/event-sourcing">Kurrent - What is Event Sourcing?</a></li> <li><a href="https://www.kurrent.io/blog/event-sourcing-and-cqrs">Kurrent - Event Sourcing and CQRS</a></li> <li><a href="https://docs.aws.amazon.com/ko_kr/prescriptive-guidance/latest/modernization-data-persistence/cqrs-pattern.html">AWS Prescriptive Guidance - CQRS 패턴</a></li> <li><a href="https://learn.microsoft.com/ko-kr/azure/architecture/patterns/event-sourcing">microsoft learn- event-sourcing</a></li> <li><a href="https://learn.microsoft.com/ko-kr/azure/architecture/patterns/cqrs">microsoft learn- CQRS</a></li> </ul> <p>출처는 아니지만 관련된 글</p> <ul> <li><a href="https://techblog.woowahan.com/13101/">우아한형제들 기술블로그 - [배민스토어] 배민스토어에 이벤트 기반 아키텍처를 곁들인…</a></li> <li><a href="https://docs.aws.amazon.com/ko_kr/prescriptive-guidance/latest/cloud-design-patterns/event-sourcing.html">AWS Prescriptive Guidance - 이벤트 소싱 패턴</a></li> </ul> </main> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
